<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business ID System - Final Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .status-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-results {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .info {
            color: #3498db;
        }
        
        .warning {
            color: #f39c12;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .summary-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .summary-card h4 {
            color: #2c3e50;
            margin: 0 0 10px 0;
        }
        
        .summary-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        input[type="text"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 0.95em;
            min-width: 200px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge.success { background: #d4edda; color: #155724; }
        .badge.error { background: #f8d7da; color: #721c24; }
        .badge.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Business ID System</h1>
            <div class="status-badge">FINAL VALIDATION</div>
            <p style="color: #666; font-size: 1.1em;">Comprehensive testing of the simplified business ID generation system</p>
        </div>

        <!-- System Status -->
        <div class="test-section">
            <h3>üìä System Status</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="systemProgress"></div>
            </div>
            <div id="systemStatus" class="test-results">
                Initializing system validation...
            </div>
        </div>

        <!-- Business ID Testing -->
        <div class="test-section">
            <h3>üè¢ Business ID Generation Testing</h3>
            <div class="test-controls">
                <input type="text" id="companyNameInput" placeholder="Enter company name" value="Zentry Restaurant">
                <button onclick="testBusinessIdGeneration()">Generate Business ID</button>
                <button onclick="testMultipleBusinessIds()">Generate 10 IDs</button>
                <button onclick="testUniquenessBatch()">Test Uniqueness (100 IDs)</button>
            </div>
            <div id="businessIdResults" class="test-results">
                Click "Generate Business ID" to test the new simplified ID generation system.
            </div>
        </div>

        <!-- Connection Code Testing -->
        <div class="test-section">
            <h3>üîó Connection Code Testing</h3>
            <div class="test-controls">
                <button onclick="testConnectionCodeGeneration()">Generate Connection Code</button>
                <button onclick="testMultipleConnectionCodes()">Generate 20 Codes</button>
                <button onclick="validateConnectionCodeRange()">Validate Range (1000-9999)</button>
            </div>
            <div id="connectionCodeResults" class="test-results">
                Click "Generate Connection Code" to test the simplified 4-digit connection codes.
            </div>
        </div>

        <!-- Integration Testing -->
        <div class="test-section">
            <h3>üîß Integration Testing</h3>
            <div class="test-controls">
                <button onclick="testUmbrellaManagerIntegration()">Test UmbrellaAccountManager</button>
                <button onclick="testMultiPropertyManagerIntegration()">Test MultiPropertyManager</button>
                <button onclick="testRegistrationFlow()">Test Registration Flow</button>
            </div>
            <div id="integrationResults" class="test-results">
                Click buttons to test integration with various system components.
            </div>
        </div>

        <!-- Performance Testing -->
        <div class="test-section">
            <h3>‚ö° Performance Testing</h3>
            <div class="test-controls">
                <button onclick="testGenerationSpeed()">Speed Test (1000 IDs)</button>
                <button onclick="testMemoryUsage()">Memory Usage Test</button>
                <button onclick="testErrorHandling()">Error Handling Test</button>
            </div>
            <div id="performanceResults" class="test-results">
                Click buttons to test system performance and reliability.
            </div>
        </div>

        <!-- Summary -->
        <div class="summary-grid">
            <div class="summary-card">
                <h4>Business IDs Generated</h4>
                <div class="value" id="businessIdCount">0</div>
            </div>
            <div class="summary-card">
                <h4>Connection Codes Generated</h4>
                <div class="value" id="connectionCodeCount">0</div>
            </div>
            <div class="summary-card">
                <h4>Tests Passed</h4>
                <div class="value" id="testsPassedCount">0</div>
            </div>
            <div class="summary-card">
                <h4>System Status</h4>
                <div class="value" id="overallStatus">READY</div>
            </div>
        </div>
    </div>

    <!-- Include necessary scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-manager.js"></script>
    <script src="js/umbrella-account-manager.js"></script>
    <script src="multi-property-manager.js"></script>

    <script>
        // Global counters
        let businessIdCount = 0;
        let connectionCodeCount = 0;
        let testsPassedCount = 0;
        
        // Wait for Firebase to initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeSystem();
        });

        async function initializeSystem() {
            const statusDiv = document.getElementById('systemStatus');
            const progressBar = document.getElementById('systemProgress');
            
            try {
                statusDiv.innerHTML = '<span class="info">üîÑ Initializing Firebase services...</span>';
                progressBar.style.width = '25%';
                
                // Wait for Firebase services
                await new Promise(resolve => {
                    const checkFirebase = () => {
                        if (window.firebaseServices && window.firebaseManager) {
                            resolve();
                        } else {
                            setTimeout(checkFirebase, 100);
                        }
                    };
                    checkFirebase();
                });
                
                statusDiv.innerHTML += '<br><span class="success">‚úÖ Firebase services initialized</span>';
                progressBar.style.width = '50%';
                
                // Wait for umbrella manager
                await new Promise(resolve => {
                    const checkUmbrella = () => {
                        if (window.umbrellaManager) {
                            resolve();
                        } else {
                            setTimeout(checkUmbrella, 100);
                        }
                    };
                    checkUmbrella();
                });
                
                statusDiv.innerHTML += '<br><span class="success">‚úÖ Umbrella Account Manager initialized</span>';
                progressBar.style.width = '75%';
                
                // Check MultiPropertyManager
                if (window.MultiPropertyManager) {
                    statusDiv.innerHTML += '<br><span class="success">‚úÖ Multi Property Manager available</span>';
                } else {
                    statusDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Multi Property Manager not available</span>';
                }
                
                progressBar.style.width = '100%';
                statusDiv.innerHTML += '<br><br><span class="success">üéâ System fully initialized and ready for testing!</span>';
                
            } catch (error) {
                statusDiv.innerHTML += '<br><span class="error">‚ùå Initialization error: ' + error.message + '</span>';
                progressBar.style.width = '0%';
            }
        }

        async function testBusinessIdGeneration() {
            const companyName = document.getElementById('companyNameInput').value || 'Test Company';
            const resultsDiv = document.getElementById('businessIdResults');
            
            try {
                resultsDiv.innerHTML = '<span class="info">üîÑ Generating business ID for: ' + companyName + '</span>';
                
                const startTime = performance.now();
                
                // Test UmbrellaAccountManager method
                let businessId;
                if (window.umbrellaManager && window.umbrellaManager.generateSimpleBusinessId) {
                    businessId = await window.umbrellaManager.generateSimpleBusinessId(companyName);
                } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                    businessId = window.MultiPropertyManager.generateSimpleBusinessId(companyName);
                } else {
                    throw new Error('No business ID generation method available');
                }
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ Generated Business ID: <strong>' + businessId + '</strong></span>';
                resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Generation time: ' + duration + 'ms</span>';
                resultsDiv.innerHTML += '<br><span class="info">üìè Length: ' + businessId.length + ' characters</span>';
                
                // Validate format
                const isValidFormat = /^[A-Z]{3}\d{3}$/.test(businessId);
                if (isValidFormat) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Format validation: PASSED</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå Format validation: FAILED</span>';
                }
                
                businessIdCount++;
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Error: ' + error.message + '</span>';
            }
        }

        async function testMultipleBusinessIds() {
            const resultsDiv = document.getElementById('businessIdResults');
            const companies = ['Zentry Restaurant', 'McDonalds', 'Starbucks', 'Pizza Hut', 'KFC', 'Subway', 'Burger King', 'Taco Bell', 'Dominos', 'Papa Johns'];
            
            resultsDiv.innerHTML = '<span class="info">üîÑ Generating 10 business IDs...</span>';
            
            const generatedIds = [];
            const startTime = performance.now();
            
            for (let i = 0; i < companies.length; i++) {
                try {
                    let businessId;
                    if (window.umbrellaManager && window.umbrellaManager.generateSimpleBusinessId) {
                        businessId = await window.umbrellaManager.generateSimpleBusinessId(companies[i]);
                    } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        businessId = window.MultiPropertyManager.generateSimpleBusinessId(companies[i]);
                    } else {
                        throw new Error('No business ID generation method available');
                    }
                    
                    generatedIds.push(businessId);
                    resultsDiv.innerHTML += '<br><span class="success">' + (i + 1) + '. ' + companies[i] + ' ‚Üí ' + businessId + '</span>';
                    businessIdCount++;
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="error">' + (i + 1) + '. ' + companies[i] + ' ‚Üí ERROR: ' + error.message + '</span>';
                }
            }
            
            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);
            
            // Check for duplicates
            const uniqueIds = [...new Set(generatedIds)];
            const hasDuplicates = uniqueIds.length !== generatedIds.length;
            
            resultsDiv.innerHTML += '<br><br><span class="info">üìä Results Summary:</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Total time: ' + duration + 'ms</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚ö° Average per ID: ' + Math.round(duration / companies.length) + 'ms</span>';
            resultsDiv.innerHTML += '<br><span class="' + (hasDuplicates ? 'error' : 'success') + '">üîç Duplicates: ' + (hasDuplicates ? 'FOUND' : 'NONE') + '</span>';
            
            if (!hasDuplicates) {
                testsPassedCount++;
            }
            
            updateCounters();
        }

        async function testUniquenessBatch() {
            const resultsDiv = document.getElementById('businessIdResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing uniqueness with 100 IDs...</span>';
            
            const generatedIds = [];
            const startTime = performance.now();
            
            for (let i = 0; i < 100; i++) {
                try {
                    let businessId;
                    if (window.umbrellaManager && window.umbrellaManager.generateSimpleBusinessId) {
                        businessId = await window.umbrellaManager.generateSimpleBusinessId('Test Company ' + i);
                    } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        businessId = window.MultiPropertyManager.generateSimpleBusinessId('Test Company ' + i);
                    } else {
                        throw new Error('No business ID generation method available');
                    }
                    
                    generatedIds.push(businessId);
                    businessIdCount++;
                    
                    if (i % 10 === 9) {
                        resultsDiv.innerHTML += '<br><span class="info">üîÑ Generated ' + (i + 1) + '/100 IDs...</span>';
                    }
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå Error at ID ' + (i + 1) + ': ' + error.message + '</span>';
                }
            }
            
            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);
            
            // Analyze results
            const uniqueIds = [...new Set(generatedIds)];
            const duplicateCount = generatedIds.length - uniqueIds.length;
            const successRate = (uniqueIds.length / generatedIds.length) * 100;
            
            resultsDiv.innerHTML += '<br><br><span class="info">üìä Uniqueness Test Results:</span>';
            resultsDiv.innerHTML += '<br><span class="info">üì¶ Total generated: ' + generatedIds.length + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">üîê Unique IDs: ' + uniqueIds.length + '</span>';
            resultsDiv.innerHTML += '<br><span class="' + (duplicateCount === 0 ? 'success' : 'warning') + '">üîÑ Duplicates: ' + duplicateCount + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">üìà Success rate: ' + successRate.toFixed(2) + '%</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Total time: ' + duration + 'ms</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚ö° Average per ID: ' + Math.round(duration / generatedIds.length) + 'ms</span>';
            
            if (successRate >= 99) {
                testsPassedCount++;
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ Uniqueness test: PASSED</span>';
            } else {
                resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Uniqueness test: NEEDS REVIEW</span>';
            }
            
            updateCounters();
        }

        async function testConnectionCodeGeneration() {
            const resultsDiv = document.getElementById('connectionCodeResults');
            
            try {
                resultsDiv.innerHTML = '<span class="info">üîÑ Generating connection code...</span>';
                
                const startTime = performance.now();
                
                // Test connection code generation
                let connectionCode;
                if (window.umbrellaManager && window.umbrellaManager.generateSimpleConnectionCode) {
                    connectionCode = await window.umbrellaManager.generateSimpleConnectionCode();
                } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateConnectionCode) {
                    connectionCode = window.MultiPropertyManager.generateConnectionCode();
                } else {
                    // Fallback to direct generation
                    connectionCode = Math.floor(1000 + Math.random() * 9000).toString();
                }
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ Generated Connection Code: <strong>' + connectionCode + '</strong></span>';
                resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Generation time: ' + duration + 'ms</span>';
                resultsDiv.innerHTML += '<br><span class="info">üìè Length: ' + connectionCode.length + ' digits</span>';
                
                // Validate format (4-digit number between 1000-9999)
                const codeNum = parseInt(connectionCode);
                const isValidFormat = /^\d{4}$/.test(connectionCode) && codeNum >= 1000 && codeNum <= 9999;
                
                if (isValidFormat) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Format validation: PASSED (1000-9999 range)</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå Format validation: FAILED</span>';
                }
                
                connectionCodeCount++;
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Error: ' + error.message + '</span>';
            }
        }

        async function testMultipleConnectionCodes() {
            const resultsDiv = document.getElementById('connectionCodeResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Generating 20 connection codes...</span>';
            
            const generatedCodes = [];
            const startTime = performance.now();
            
            for (let i = 0; i < 20; i++) {
                try {
                    let connectionCode;
                    if (window.umbrellaManager && window.umbrellaManager.generateSimpleConnectionCode) {
                        connectionCode = await window.umbrellaManager.generateSimpleConnectionCode();
                    } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateConnectionCode) {
                        connectionCode = window.MultiPropertyManager.generateConnectionCode();
                    } else {
                        connectionCode = Math.floor(1000 + Math.random() * 9000).toString();
                    }
                    
                    generatedCodes.push(connectionCode);
                    resultsDiv.innerHTML += '<br><span class="success">' + (i + 1) + '. ' + connectionCode + '</span>';
                    connectionCodeCount++;
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="error">' + (i + 1) + '. ERROR: ' + error.message + '</span>';
                }
            }
            
            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);
            
            // Check for duplicates and validate range
            const uniqueCodes = [...new Set(generatedCodes)];
            const hasDuplicates = uniqueCodes.length !== generatedCodes.length;
            const allInRange = generatedCodes.every(code => {
                const num = parseInt(code);
                return num >= 1000 && num <= 9999;
            });
            
            resultsDiv.innerHTML += '<br><br><span class="info">üìä Results Summary:</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Total time: ' + duration + 'ms</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚ö° Average per code: ' + Math.round(duration / 20) + 'ms</span>';
            resultsDiv.innerHTML += '<br><span class="' + (hasDuplicates ? 'error' : 'success') + '">üîç Duplicates: ' + (hasDuplicates ? 'FOUND' : 'NONE') + '</span>';
            resultsDiv.innerHTML += '<br><span class="' + (allInRange ? 'success' : 'error') + '">üìè Range validation: ' + (allInRange ? 'PASSED' : 'FAILED') + '</span>';
            
            if (!hasDuplicates && allInRange) {
                testsPassedCount++;
            }
            
            updateCounters();
        }

        async function validateConnectionCodeRange() {
            const resultsDiv = document.getElementById('connectionCodeResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Validating connection code range (1000-9999)...</span>';
            
            const testCodes = [];
            const outOfRangeCodes = [];
            const startTime = performance.now();
            
            // Generate 50 codes and check range
            for (let i = 0; i < 50; i++) {
                try {
                    let connectionCode;
                    if (window.umbrellaManager && window.umbrellaManager.generateSimpleConnectionCode) {
                        connectionCode = await window.umbrellaManager.generateSimpleConnectionCode();
                    } else if (window.MultiPropertyManager && window.MultiPropertyManager.generateConnectionCode) {
                        connectionCode = window.MultiPropertyManager.generateConnectionCode();
                    } else {
                        connectionCode = Math.floor(1000 + Math.random() * 9000).toString();
                    }
                    
                    testCodes.push(connectionCode);
                    connectionCodeCount++;
                    
                    const codeNum = parseInt(connectionCode);
                    if (codeNum < 1000 || codeNum > 9999) {
                        outOfRangeCodes.push(connectionCode);
                    }
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå Error generating code ' + (i + 1) + ': ' + error.message + '</span>';
                }
            }
            
            const endTime = performance.now();
            const duration = Math.round(endTime - startTime);
            
            // Calculate statistics
            const minCode = Math.min(...testCodes.map(code => parseInt(code)));
            const maxCode = Math.max(...testCodes.map(code => parseInt(code)));
            const avgCode = Math.round(testCodes.reduce((sum, code) => sum + parseInt(code), 0) / testCodes.length);
            
            resultsDiv.innerHTML += '<br><br><span class="info">üìä Range Validation Results:</span>';
            resultsDiv.innerHTML += '<br><span class="info">üì¶ Codes tested: ' + testCodes.length + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">üìâ Minimum: ' + minCode + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">üìà Maximum: ' + maxCode + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">üìä Average: ' + avgCode + '</span>';
            resultsDiv.innerHTML += '<br><span class="' + (outOfRangeCodes.length === 0 ? 'success' : 'error') + '">üéØ Out of range: ' + outOfRangeCodes.length + '</span>';
            resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Total time: ' + duration + 'ms</span>';
            
            if (outOfRangeCodes.length === 0) {
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ Range validation: PASSED</span>';
                testsPassedCount++;
            } else {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Range validation: FAILED</span>';
                resultsDiv.innerHTML += '<br><span class="error">Out of range codes: ' + outOfRangeCodes.join(', ') + '</span>';
            }
            
            updateCounters();
        }

        function testUmbrellaManagerIntegration() {
            const resultsDiv = document.getElementById('integrationResults');
            
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing UmbrellaAccountManager integration...</span>';
            
            try {
                // Check if UmbrellaAccountManager is available
                if (!window.umbrellaManager) {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå UmbrellaAccountManager not found</span>';
                    return;
                }
                
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ UmbrellaAccountManager instance found</span>';
                
                // Check if required methods exist
                const requiredMethods = ['generateSimpleBusinessId', 'generateSimpleConnectionCode', 'createBusiness', 'createProperty'];
                let methodsFound = 0;
                
                requiredMethods.forEach(method => {
                    if (typeof window.umbrellaManager[method] === 'function') {
                        resultsDiv.innerHTML += '<br><span class="success">‚úÖ Method ' + method + '() available</span>';
                        methodsFound++;
                    } else {
                        resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Method ' + method + '() not found</span>';
                    }
                });
                
                // Check Firebase integration
                if (window.umbrellaManager.db) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Firebase integration active</span>';
                    methodsFound++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Firebase integration not detected</span>';
                }
                
                const successRate = (methodsFound / (requiredMethods.length + 1)) * 100;
                resultsDiv.innerHTML += '<br><br><span class="info">üìä Integration Score: ' + Math.round(successRate) + '%</span>';
                
                if (successRate >= 80) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ UmbrellaAccountManager integration: PASSED</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è UmbrellaAccountManager integration: NEEDS ATTENTION</span>';
                }
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Integration test error: ' + error.message + '</span>';
            }
        }

        function testMultiPropertyManagerIntegration() {
            const resultsDiv = document.getElementById('integrationResults');
            
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing MultiPropertyManager integration...</span>';
            
            try {
                // Check if MultiPropertyManager is available
                if (!window.MultiPropertyManager) {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå MultiPropertyManager not found</span>';
                    return;
                }
                
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ MultiPropertyManager class found</span>';
                
                // Check if required static methods exist
                const requiredMethods = ['generateSimpleBusinessId', 'generateConnectionCode', 'createBusinessAccount'];
                let methodsFound = 0;
                
                requiredMethods.forEach(method => {
                    if (typeof window.MultiPropertyManager[method] === 'function') {
                        resultsDiv.innerHTML += '<br><span class="success">‚úÖ Static method ' + method + '() available</span>';
                        methodsFound++;
                    } else {
                        resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Static method ' + method + '() not found</span>';
                    }
                });
                
                const successRate = (methodsFound / requiredMethods.length) * 100;
                resultsDiv.innerHTML += '<br><br><span class="info">üìä Integration Score: ' + Math.round(successRate) + '%</span>';
                
                if (successRate >= 80) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ MultiPropertyManager integration: PASSED</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è MultiPropertyManager integration: NEEDS ATTENTION</span>';
                }
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Integration test error: ' + error.message + '</span>';
            }
        }

        function testRegistrationFlow() {
            const resultsDiv = document.getElementById('integrationResults');
            
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing registration flow integration...</span>';
            
            try {
                // Check if we can simulate the registration flow
                const testBusinessData = {
                    businessName: 'Test Restaurant',
                    ownerName: 'Test Owner',
                    email: 'test@example.com',
                    phone: '123-456-7890',
                    propertyName: 'Main Location',
                    businessType: 'restaurant',
                    address: '123 Test St',
                    country: 'united-states',
                    state: 'california'
                };
                
                resultsDiv.innerHTML += '<br><span class="info">üìã Test business data prepared</span>';
                
                // Test business account creation (dry run)
                if (window.MultiPropertyManager && window.MultiPropertyManager.createBusinessAccount) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Registration flow method available</span>';
                    
                    // Test ID generation for the registration
                    const businessId = window.MultiPropertyManager.generateSimpleBusinessId(testBusinessData.businessName);
                    const connectionCode = window.MultiPropertyManager.generateConnectionCode();
                    
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Would generate Business ID: ' + businessId + '</span>';
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Would generate Connection Code: ' + connectionCode + '</span>';
                    
                    // Validate generated IDs format
                    const businessIdValid = /^[A-Z]{3}\d{3}$/.test(businessId);
                    const connectionCodeValid = /^\d{4}$/.test(connectionCode) && parseInt(connectionCode) >= 1000 && parseInt(connectionCode) <= 9999;
                    
                    if (businessIdValid && connectionCodeValid) {
                        resultsDiv.innerHTML += '<br><span class="success">‚úÖ Registration flow integration: PASSED</span>';
                        testsPassedCount++;
                    } else {
                        resultsDiv.innerHTML += '<br><span class="error">‚ùå Generated ID format validation failed</span>';
                    }
                } else {
                    resultsDiv.innerHTML += '<br><span class="error">‚ùå Registration flow method not available</span>';
                }
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Registration flow test error: ' + error.message + '</span>';
            }
        }

        async function testGenerationSpeed() {
            const resultsDiv = document.getElementById('performanceResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Running speed test (1000 business IDs)...</span>';
            
            const iterations = 1000;
            const startTime = performance.now();
            
            try {
                for (let i = 0; i < iterations; i++) {
                    let businessId;
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        businessId = window.MultiPropertyManager.generateSimpleBusinessId('Test Company ' + i);
                    } else {
                        // Fallback to direct generation
                        const cleanedName = ('Test Company ' + i).replace(/[^A-Z]/gi, '').toUpperCase();
                        const namePart = cleanedName.substring(0, 3).padEnd(3, 'X');
                        const numberPart = Math.floor(100 + Math.random() * 900);
                        businessId = `${namePart}${numberPart}`;
                    }
                    businessIdCount++;
                    
                    if (i % 100 === 99) {
                        resultsDiv.innerHTML += '<br><span class="info">üîÑ Generated ' + (i + 1) + '/' + iterations + ' IDs...</span>';
                    }
                }
                
                const endTime = performance.now();
                const totalTime = endTime - startTime;
                const avgTime = totalTime / iterations;
                const idsPerSecond = Math.round(1000 / avgTime);
                
                resultsDiv.innerHTML += '<br><br><span class="info">üìä Performance Results:</span>';
                resultsDiv.innerHTML += '<br><span class="success">‚úÖ Generated ' + iterations + ' business IDs</span>';
                resultsDiv.innerHTML += '<br><span class="info">‚è±Ô∏è Total time: ' + Math.round(totalTime) + 'ms</span>';
                resultsDiv.innerHTML += '<br><span class="info">‚ö° Average per ID: ' + avgTime.toFixed(3) + 'ms</span>';
                resultsDiv.innerHTML += '<br><span class="info">üöÄ IDs per second: ' + idsPerSecond + '</span>';
                
                if (avgTime < 1) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Speed test: EXCELLENT (< 1ms per ID)</span>';
                    testsPassedCount++;
                } else if (avgTime < 5) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Speed test: GOOD (< 5ms per ID)</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Speed test: NEEDS OPTIMIZATION (> 5ms per ID)</span>';
                }
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Speed test error: ' + error.message + '</span>';
            }
        }

        function testMemoryUsage() {
            const resultsDiv = document.getElementById('performanceResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing memory usage...</span>';
            
            try {
                const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 'N/A';
                
                // Generate a large batch of IDs
                const generatedIds = [];
                for (let i = 0; i < 10000; i++) {
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        generatedIds.push(window.MultiPropertyManager.generateSimpleBusinessId('Test ' + i));
                    } else {
                        const cleanedName = ('Test ' + i).replace(/[^A-Z]/gi, '').toUpperCase();
                        const namePart = cleanedName.substring(0, 3).padEnd(3, 'X');
                        const numberPart = Math.floor(100 + Math.random() * 900);
                        generatedIds.push(`${namePart}${numberPart}`);
                    }
                }
                
                const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 'N/A';
                
                resultsDiv.innerHTML += '<br><span class="info">üìä Memory Usage Results:</span>';
                resultsDiv.innerHTML += '<br><span class="info">üì¶ Generated: 10,000 IDs</span>';
                
                if (performance.memory) {
                    const memoryDiff = finalMemory - initialMemory;
                    const memoryPerID = memoryDiff / 10000;
                    
                    resultsDiv.innerHTML += '<br><span class="info">üíæ Initial memory: ' + Math.round(initialMemory / 1024 / 1024) + ' MB</span>';
                    resultsDiv.innerHTML += '<br><span class="info">üíæ Final memory: ' + Math.round(finalMemory / 1024 / 1024) + ' MB</span>';
                    resultsDiv.innerHTML += '<br><span class="info">üìà Memory increase: ' + Math.round(memoryDiff / 1024) + ' KB</span>';
                    resultsDiv.innerHTML += '<br><span class="info">üîç Memory per ID: ' + memoryPerID.toFixed(2) + ' bytes</span>';
                    
                    if (memoryPerID < 100) {
                        resultsDiv.innerHTML += '<br><span class="success">‚úÖ Memory usage: EXCELLENT (< 100 bytes per ID)</span>';
                        testsPassedCount++;
                    } else {
                        resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Memory usage: ACCEPTABLE but could be optimized</span>';
                    }
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Memory API not available in this browser</span>';
                }
                
                // Clean up
                generatedIds.length = 0;
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Memory test error: ' + error.message + '</span>';
            }
        }

        function testErrorHandling() {
            const resultsDiv = document.getElementById('performanceResults');
            resultsDiv.innerHTML = '<span class="info">üîÑ Testing error handling...</span>';
            
            try {
                let errorsCaught = 0;
                const totalTests = 5;
                
                // Test 1: Empty company name
                try {
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        window.MultiPropertyManager.generateSimpleBusinessId('');
                    }
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Empty name test: No error thrown</span>';
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Empty name test: Error properly caught</span>';
                    errorsCaught++;
                }
                
                // Test 2: Null company name
                try {
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        window.MultiPropertyManager.generateSimpleBusinessId(null);
                    }
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Null name test: No error thrown</span>';
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Null name test: Error properly caught</span>';
                    errorsCaught++;
                }
                
                // Test 3: Non-string input
                try {
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        window.MultiPropertyManager.generateSimpleBusinessId(123);
                    }
                    resultsDiv.innerHTML += '<br><span class="info">‚ÑπÔ∏è Number input test: Handled gracefully</span>';
                    errorsCaught++;
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Number input test: Error properly caught</span>';
                    errorsCaught++;
                }
                
                // Test 4: Very long company name
                try {
                    const longName = 'A'.repeat(1000);
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        const result = window.MultiPropertyManager.generateSimpleBusinessId(longName);
                        if (result && result.length === 6) {
                            resultsDiv.innerHTML += '<br><span class="success">‚úÖ Long name test: Handled properly (truncated)</span>';
                            errorsCaught++;
                        } else {
                            resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Long name test: Unexpected result</span>';
                        }
                    }
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Long name test: Unexpected error</span>';
                }
                
                // Test 5: Special characters only
                try {
                    if (window.MultiPropertyManager && window.MultiPropertyManager.generateSimpleBusinessId) {
                        const result = window.MultiPropertyManager.generateSimpleBusinessId('!@#$%^&*()');
                        if (result && /^[A-Z]{3}\d{3}$/.test(result)) {
                            resultsDiv.innerHTML += '<br><span class="success">‚úÖ Special chars test: Handled properly (fallback to X)</span>';
                            errorsCaught++;
                        } else {
                            resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Special chars test: Unexpected result</span>';
                        }
                    }
                } catch (error) {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Special chars test: Unexpected error</span>';
                }
                
                const errorHandlingScore = (errorsCaught / totalTests) * 100;
                resultsDiv.innerHTML += '<br><br><span class="info">üìä Error Handling Score: ' + Math.round(errorHandlingScore) + '%</span>';
                
                if (errorHandlingScore >= 80) {
                    resultsDiv.innerHTML += '<br><span class="success">‚úÖ Error handling: ROBUST</span>';
                    testsPassedCount++;
                } else {
                    resultsDiv.innerHTML += '<br><span class="warning">‚ö†Ô∏è Error handling: NEEDS IMPROVEMENT</span>';
                }
                
                updateCounters();
                
            } catch (error) {
                resultsDiv.innerHTML += '<br><span class="error">‚ùå Error handling test failed: ' + error.message + '</span>';
            }
        }

        function updateCounters() {
            document.getElementById('businessIdCount').textContent = businessIdCount;
            document.getElementById('connectionCodeCount').textContent = connectionCodeCount;
            document.getElementById('testsPassedCount').textContent = testsPassedCount;
            
            // Update overall status
            const totalPossibleTests = 10; // Approximate number of tests that increment the counter
            if (testsPassedCount >= totalPossibleTests * 0.8) {
                document.getElementById('overallStatus').textContent = 'EXCELLENT';
                document.getElementById('overallStatus').style.color = '#27ae60';
            } else if (testsPassedCount >= totalPossibleTests * 0.6) {
                document.getElementById('overallStatus').textContent = 'GOOD';
                document.getElementById('overallStatus').style.color = '#3498db';
            } else {
                document.getElementById('overallStatus').textContent = 'NEEDS WORK';
                document.getElementById('overallStatus').style.color = '#f39c12';
            }
        }
    </script>
</body>
</html>
